<!-- 
Tailwindのおまじない
cd frontend
npx tailwindcss -i ./css/style.css -o ./css//twind.css --watch
-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/twind.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pattaya&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <title>新規登録｜ToryDory</title>
    <link rel="icon" href="image/marulogo.ico" />

    <script type="text/javascript" src="/js/general.js"></script>
    <script type="text/javascript" src="/js/api.js"></script>
  </head>
  <body class="bg-slate-300">
    <div id="header" class="relative h-[56px]xl:h-[72px]">
      <div>
        <div class="bg-[#8ECAE6] h-5 xl:h-6"></div>
        <div class="bg-[#219EBC] h-4 xl:h-5"></div>
        <div class="bg-[#126782] h-3 xl:h-4"></div>
        <div class="bg-[#023047] h-2 xl:h-3"></div>
      </div>
      <div
        class="flex ml-1 mr-1 xl:ml-3 xl:mr-3 absolute top-1 xl:top-1 xl:left-0"
      >
        <img
          src="image\header_logo_1.svg"
          alt="ヘッダーロゴ"
          class="h-10 xl:h-12"
        />
        <h1
          class="text-4xl xl:text-5xl font-pattaya ml-1 xl:ml-2 pt-1 xl:pt-0 text-white"
        >
          ToryDory
        </h1>
        <img
          src="image\header_island.svg"
          alt="ヘッダー島"
          class="h-10 xl:h-12 ml-2 xl:ml-3"
        />
      </div>
    </div>
    <div
      id="main"
      class="mt-2 xl:mt-0 ml-0 xl:ml-20 mr-0 xl:mr-20 mb-6 xl:mb-8"
    >
      <div
        class="bg-[#c8d5b9] shadow-lg rounded xl:rounded-b xl:rounded-t-none pb-6 xl:pb-20 mr-2 xl:mr-0 ml-2 xl:ml-0"
      >
        <div class="xl:ml-4 xl:mr-4 pt-2 xl:pt-4">
          <div class="ml-2 xl:ml-4 mb-2 xl:mb-4">
            <h2
              class="text-[#023047] text-[170%] xl:text-[300%] font-pattaya h-9 xl:h-16"
            >
              Seafarer Registration
            </h2>
            <h4
              class="text-[#023047] text-[80%] xl:text-[150%] font-nsjp xl:font-medium"
            >
              新規登録
            </h4>
          </div>
          <div class="xl:ml-[10%] xl:mr-[10%] mb-2 xl:mb-8">
            <img
              src="image\Hero.svg"
              alt="ヒーロー画像"
              class="block shadow-md ml-4 xl:ml-0 mr-4 xl:mr-0 xl:mt-2 rounded border-4 border-white"
            />
          </div>
          <div class="xl:mt-8 ml-auto mr-auto w-fit xl:w-fit scale-100">
            <div id="megs" class="text-red-600 text-sm xl:text-base text-center">&nbsp;</div>
            <label
              class="text-left font-nsjp font-semibold xl:mb-1 text-sm xl:text-2xl text-slate-800"
              for="nickname"
            >
              ニックネーム
            </label>
            <br />
            <input
              type="text"
              class="xl:text-lg border-4 shadow border-slate-600 w-full xl:w-full rounded"
              id="nickname"
              name="nickname"
              required
            />
            <br />
            <label
              class="text-left font-nsjp font-semibold xl:mb-1 text-sm xl:text-2xl text-slate-800"
              for="email"
            >
              メールアドレス
            </label>
            <br />
            <input
              type="email"
              class="xl:text-lg border-4 shadow border-slate-600 w-full xl:w-full rounded"
              id="email"
              name="email"
              required
            />
            <br />
            <label
              class="text-left font-nsjp font-semibold xl:mb-1 text-sm xl:text-2xl text-slate-800"
              for="password"
            >
              パスワード
            </label>
            <br />
            <input
              type="password"
              class="xl:text-lg border-4 shadow border-slate-600 w-full xl:w-full rounded"
              id="password"
              name="password"
              required
            />
            <br />
            <label
              class="text-left font-nsjp font-semibold xl:mb-1 text-sm xl:text-2xl text-slate-800"
              for="password"
            >
              アイコン画像
            </label>
            <br />
            <figure
              id="figure"
              class="ml-auto mr-auto mb-1 xl:mb-2 flex flex-col h-[100px] xl:h-[150px] w-[100px] xl:w-[150px] items-center text-center justify-center bg-slate-200 rounded-full"
            >
              <figcaption>
                <span
                  class="material-symbols-outlined !text-4xl xl:!text-6xl text-slate-600"
                  id="upload-button"
                >
                  account_circle
                </span>
              </figcaption>
              <img src="" alt="" id="figureImage" class="w-full h-full rounded-full object-cover hidden"/>
            </figure>
            <input
              type="file"
              id="icon-image-input"
              name="icon_img"
              class="text-xs xl:text-xl"
              accept="image/*"
            />
            <div class="mt-4 xl:mt-6 justify ml-auto text-center">
              <button
                class="xl:text-2xl shadow-md w-fit pl-2 xl:pl-[1.5vw] pr-2 xl:pr-[1.5vw] pb-1 xl:pb-2 xl:pt-1 bg-[#8ECAE6] border-2 xl:border-4 border-white font-nsjp font-semibold text-[#023047] rounded"
                onclick="register()"
              >
                新規登録
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="footer" class="flex items-center w-fit mx-auto xl:mb-4">
      <img
        src="image/marulogo.svg"
        alt="marulogo"
        class="h-6 xl:h-8 mr-1 xl:mr-2"
      />
      <p class="text-center text-[#023047] font-nsjp text-[50%] xl:text-[100%]">
        ©2024 Nishibori Sorachi All rights reserved.
      </p>
    </div>
  </body>

  <script>
    if (checkLogin()) {
      location.href = "/index.html";
    }

    function main() {
      const input = document.getElementById("icon-image-input");
      const figure = document.getElementById("figure");
      const circle = document.getElementById("upload-button");
      const figureImage = document.getElementById("figureImage");

      input.addEventListener("change", (event) => {
        // <1>
        const [file] = event.target.files;

        if (file) {
          figureImage.setAttribute("src", URL.createObjectURL(file));
          figureImage.style.display = "block";
          circle.style.display = "none";
        }
      });
    }

    main();

    const register = () => {
      // フォームの値を取得
      // .trim()で前後の空白を削除
      const nickname = document.getElementById("nickname").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const iconImageInput = document.getElementById("icon-image-input");

      // メッセージを表示するための要素を取得
      const megsBox = document.getElementById("megs");

      // 全ての項目が入力されているかチェック
      if (nickname === "" || email === "" || password === "") {
        megsBox.innerText = "全ての項目を入力してください";
        return;
      }

      // API用データを作成する
      const data = {
        email: email,
        nickname: nickname,
        password: password,
      };
      // API操作を呼び出す
      signUpApi(data)
        .then((res) => {
          // 画像がある場合は、画像をアップロード
          if (iconImageInput.files.length !== 0) {
            console.log(res.id);
            console.log(iconImageInput.files[0]);
            updateiconImageApi(res.id, iconImageInput.files[0]);
          }
          megsBox.innerHTML =
            '新規登録に成功しました <a href="/login.html">ログインページへ</a>';
        })
        .catch((error) => {
          megsBox.innerText = error.message;
        });
    };
  </script>
</html>
